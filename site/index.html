<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Music Playlist Server</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
    code, pre { background: #f6f8fa; padding: .2rem .4rem; border-radius: 4px; }
    .box { border: 1px solid #e5e7eb; border-radius: 12px; padding: 1rem 1.25rem; }
    a { text-decoration: none; }
  </style>
</head>
<body>
  <h1>ðŸŽµ Music Playlist Server</h1>
  <div class="box">
    <p>Drop audio files into the <code>music/</code> folder on your host, run <code>./generate_playlist.sh</code>, then open <a href="/playlist.m3u">/playlist.m3u</a> in your media player.</p>
    <p>You can also browse your files at <a href="/music/">/music/</a>.</p>
  </div>

  <h2>Quick Test</h2>
  <p>If you click a song below, it will play here:</p>
  <audio id="player" controls style="width: 100%; margin: .5rem 0;"></audio>
  <ul id="songs"></ul>

  <script>
    async function listSongs() {
      try {
        const res = await fetch('/music/');
        const html = await res.text();
        // Quick and dirty parse of links from autoindex
        const div = document.createElement('div');
        div.innerHTML = html;
        const links = Array.from(div.querySelectorAll('a'))
          .map(a => a.getAttribute('href'))
          .filter(href => href && !href.startsWith('?') && !href.startsWith('/'))
          .filter(href => href.match(/\.(mp3|m4a|aac|ogg|wav)$/i));
        const ul = document.getElementById('songs');
        const player = document.getElementById('player');
        links.forEach(href => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '/music/' + href;
          a.textContent = href;
          a.onclick = (e) => {
            e.preventDefault();
            player.src = a.href;
            player.play();
          };
          li.appendChild(a);
          ul.appendChild(li);
        });
      } catch (e) {
        console.error(e);
      }
    }
    listSongs();
  </script>
</body>
</html>
